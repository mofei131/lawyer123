{"version":3,"sources":["uni-app:///main.js","webpack:///D:/咸鱼/20210806律师uniapp/pages/chat/chat.vue?95db","webpack:///D:/咸鱼/20210806律师uniapp/pages/chat/chat.vue?1992","webpack:///D:/咸鱼/20210806律师uniapp/pages/chat/chat.vue?61e8","webpack:///D:/咸鱼/20210806律师uniapp/pages/chat/chat.vue?e925","uni-app:///pages/chat/chat.vue"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,0F;AACAA,UAAU,CAACC,aAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;;;AAGnD;AAC8N;AAC9N,gBAAgB,oOAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAA23B,CAAgB,i4BAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACmB/4B,gD;;;;;;AAMA;;AAEA,UAFA,sBAEA;AACA;AACA,+BADA;;AAGA,GANA;AAOA,QAPA,kBAOA,CAPA,EAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BADA;AAEA;AACA,uCADA,EAFA,GADA;;;AAOA,YAPA,gBAOA,GAPA,EAOA;AACA;AACA,2BADA;AAEA,wBAFA;;AAIA,SAZA;;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BADA;AAEA,gCAFA;AAGA,8BAHA;AAIA,oFAJA;AAKA,iCALA;AAMA,6LANA;;AAQA;AACA;AACA;AACA;;AAEA,OApBA;;AAsBA,KArCA,MAqCA;AACA;AACA;AACA,GAtDA;AAuDA,QAvDA,oBAuDA;AACA;AACA,GAzDA;AA0DA;AACA,8BADA;AAEA,0BAFA,EA1DA;;AA8DA,MA9DA,kBA8DA;AACA;AACA,kBADA;AAEA,oBAFA;AAGA,oBAHA;AAIA,sBAJA;AAKA,aALA;AAMA,eANA;AAOA,iBAPA;AAQA,mBARA;AASA,kBATA;AAUA,cAVA;;;;AAcA,GA7EA;AA8EA;;AAEA,yEAFA;AAGA,mBAHA,6BAGA;AACA;AACA;AACA,0BADA;AAEA;AACA,uCADA,EAFA,GADA;;;AAOA;AACA;AACA,SATA;AAUA;AACA;AACA;AACA,SAbA;;AAeA,KAnBA;AAoBA,kBApBA,4BAoBA;AACA;AACA,wBAFA,CAEA;AACA;AACA,yCADA;AAEA;AACA,4CADA,EAFA;;AAKA,qBALA;AAMA,eANA,mBAMA,GANA,EAMA;AACA;AACA,SARA;AASA;;AAEA;;AAEA,SAbA;;AAeA;AACA;AACA;AACA;AACA,4BADA;AAEA;AACA,2CADA,EAFA,GADA;;;AAOA,cAPA,gBAOA,GAPA,EAOA;AACA;AACA,6BADA;AAEA,0BAFA;;AAIA,WAZA;;;AAeA,OAjBA;AAkBA,6BApCA,CAoCA;AACA,KAzDA;AA0DA;AACA,mBA3DA,6BA2DA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,sCAJA,CAIA;AACA,OALA;AAMA,KArEA;AAsEA;AACA,gBAvEA,wBAuEA,MAvEA,EAuEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBADA;AAEA,8BAFA;AAGA,4BAHA;AAIA,+EAJA;AAKA,+BALA;AAMA,wLANA;;AAQA;AACA;AACA;AACA;AACA,KAzFA;AA0FA;AACA,SA3FA,mBA2FA;AACA;AACA,mBAFA,CAEA;AACA,KA9FA;AA+FA;AACA,SAhGA,mBAgGA;AACA;AACA;AACA,sBADA;AAEA;AACA;AACA,WAJA;AAKA;AACA;AACA;AACA,WARA;;AAUA,OAXA,EAWA,YAXA;AAYA,KA7GA;;;AAgHA,YAhHA,oBAgHA,GAhHA,EAgHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CADA;AAEA;AACA,mDADA;AAEA,qEAFA;AAGA,oCAHA,EAFA,GADA;;;AASA,yBATA,qBASA;AACA;AACA,mBAXA;AAYA;AACA;AACA,qCADA;AAEA,kCAFA;;AAIA;AACA,mBAlBA,IALA;;AAyBA,KAzIA;AA0IA;AACA;AACA;AACA;AACA,2CADA;AAEA,uBAFA;;AAIA,OALA,EAKA,GALA;AAMA,KAlJA;AAmJA,cAnJA,wBAmJA;AACA;AACA,uCADA;AAEA,kCAFA;AAGA;AACA,iDADA,EAHA,GADA,SACA,GADA;;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCADA;AAEA,0CAFA;AAGA,6FAHA;AAIA,wCAJA;AAKA,iDALA;AAMA,iGANA;;AAQA;AACA,mBAlBA;;AAoBA,iBA/BA;AAgCA,KAnLA,GA9EA,E","file":"pages/chat/chat.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/chat/chat.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chat.vue?vue&type=template&id=bf16e7f4&\"\nvar renderjs\nimport script from \"./chat.vue?vue&type=script&lang=js&\"\nexport * from \"./chat.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/chat/chat.vue\"\nexport default component.exports","export * from \"-!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=template&id=bf16e7f4&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!C:\\\\Users\\\\77543\\\\Downloads\\\\HBuilderX.3.1.12.20210428.full\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./chat.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<!-- 页面主体 -->\r\n\t\t<view class=\"flex-column mx-center sx-center\" style=\"width: 100%;  background-color: #FFFFFF;\">\r\n\t\t\t<view style=\"width: 100%;\">\r\n\t\t\t\t<!-- IM 消息展示区 -->\r\n\t\t\t\t<gui-im-message background=\"#ffffff\" :msgs=\"msgs\" group=\"group1\" :userid=\"user_id\">\r\n\t\t\t\t</gui-im-message>\r\n\t\t\t\t<!-- 底部提交区 -->\r\n\t\t\t\t<gui-im-input @sendText=\"sendText\"></gui-im-input>\r\n\t\t\t</view>\r\n\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport guiImMessage from '../../components/gui-im-message.vue'\r\n\timport guiImInput from '../../components/gui-im-input.vue'\r\n\timport {\r\n\t\tmapState,\r\n\t\tmapGetters,\r\n\t\tmapMutations,\r\n\t\tmapActions\r\n\t} from 'vuex'\r\n\texport default {\r\n\t\t\r\n\t\tonUnload() {\r\n\t\t\tuni.switchTab({\r\n\t\t\t\turl:'/pages/index/index'\r\n\t\t\t})\r\n\t\t},\r\n\t\tonLoad(p) {\r\n\t\t\tconsole.log(p);\r\n\t\t\tconsole.log(this.$store.state.userInfo);\r\n\t\t\tthis.source_id = p.source_id;\r\n\t\t\tthis.layer_id = p.layer_id;\r\n\t\t\tthis.user_id = this.$store.state.userInfo.user_id;\r\n\t\t\tconsole.log('用户id：',this.user_id);\r\n\t\t\tif (this.$store.state.websocketConnect) {\r\n\t\t\t\tuni.sendSocketMessage({\r\n\t\t\t\t\tdata: JSON.stringify({\r\n\t\t\t\t\t\t\"action\": \"bind\",\r\n\t\t\t\t\t\t\"data\": {\r\n\t\t\t\t\t\t\t\"source_id\": this.source_id,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tfail(res) {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '聊天连接失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tuni.onSocketMessage((res) => {\r\n\t\t\t\t\tconsole.log('收到服务器内容：');\r\n\t\t\t\t\tlet d = JSON.parse(res.data)\r\n\t\t\t\t\tconsole.log(d);\r\n\t\t\t\t\tif (d.type) return;\r\n\t\t\t\t\tlet data = d.data;\r\n\t\t\t\t\tif (data.source_id) {\r\n\t\t\t\t\t\tvar item = {\r\n\t\t\t\t\t\t\tgroup: 'group1',\r\n\t\t\t\t\t\t\tuindex: data.user_id,\r\n\t\t\t\t\t\t\tcontentType: 'txt',\r\n\t\t\t\t\t\t\tuname: data.user_id == this.user_id ? this.userName : this.lawyerName,\r\n\t\t\t\t\t\t\tcontent: data.message,\r\n\t\t\t\t\t\t\tuface: data.user_id == this.user_id ? this.$store.state.userInfo.avater : this.lawyerAvator || \"https://layer.boyaokj.cn/upload/20210813/1b54fb67409ad93d2eaf28ea20faa644.jpg\"\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis.msgs.push(item);\r\n\t\t\t\t\t\tthis.pageScroll()\r\n\t\t\t\t\t\tconsole.log(this.msgs);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t});\r\n\r\n\t\t\t} else {\r\n\t\t\t\tthis.checkOpenSocket();\r\n\t\t\t}\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\tthis.getMessage(this.source_id);\r\n\t\t},\r\n\t\tcomponents: {\r\n\t\t\tguiImMessage,\r\n\t\t\tguiImInput\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tuserName: '',\r\n\t\t\t\tuserAvator: '',\r\n\t\t\t\tlawyerName: '',\r\n\t\t\t\tlawyerAvator: '',\r\n\t\t\t\tpage: 1,\r\n\t\t\t\tlimit: 10,\r\n\t\t\t\tuser_id: '',\r\n\t\t\t\tsource_id: '',\r\n\t\t\t\tlayer_id: '',\r\n\t\t\t\tmsgs: [\r\n\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\r\n\t\t\t...mapMutations(['commitWebsocketConnect', 'commitSocketInfo']),\r\n\t\t\tcheckOpenSocket() {\r\n\t\t\t\tuni.sendSocketMessage({\r\n\t\t\t\t\tdata: JSON.stringify({\r\n\t\t\t\t\t\t\"action\": \"bind\",\r\n\t\t\t\t\t\t\"data\": {\r\n\t\t\t\t\t\t\t\"source_id\": this.source_id,\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: err => {\r\n\t\t\t\t\t\t// 未连接打开websocket连接\r\n\t\t\t\t\t\tthis.openConnection();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\topenConnection() {\r\n\t\t\t\t// 打开连接\r\n\t\t\t\tuni.closeSocket(); // 确保已经关闭后再重新打开\r\n\t\t\t\tuni.connectSocket({\r\n\t\t\t\t\turl: 'wss://layer.boyaokj.cn/wss',\r\n\t\t\t\t\theader: {\r\n\t\t\t\t\t\t'content-type': 'application/json'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tconsole.log('连接成功 connectSocket=', res);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\r\n\t\t\t\t\t\tconsole.log('连接失败 connectSocket=从连');\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tuni.onSocketOpen(res => {\r\n\t\t\t\t\tconsole.log('====================连接成功==================');\r\n\t\t\t\t\tuni.sendSocketMessage({\r\n\t\t\t\t\t\tdata: JSON.stringify({\r\n\t\t\t\t\t\t\t\"action\": \"bind\",\r\n\t\t\t\t\t\t\t\"data\": {\r\n\t\t\t\t\t\t\t\t\"source_id\": this.source_id,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}),\r\n\t\t\t\t\t\tfail(res) {\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle: '聊天连接失败',\r\n\t\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t});\r\n\t\t\t\tthis.onSocketMessage(); // 打开成功监听服务器返回的消息\r\n\t\t\t},\r\n\t\t\t//\t打开成功监听服务器返回的消息\r\n\t\t\tonSocketMessage() {\r\n\t\t\t\t// 消息\r\n\t\t\t\tthis.timeout = 30000;\r\n\t\t\t\tthis.timeoutObj = null;\r\n\t\t\t\tuni.onSocketMessage(res => {\r\n\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\tconsole.log('收到服务器内容：');\r\n\r\n\t\t\t\t\tthis.getSocketMsg(res.data); // 监听到有新服务器消息\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 监听到有新服务器消息\r\n\t\t\tgetSocketMsg(reData) {\r\n\t\t\t\t// 监听到服务器消息\r\n\t\t\t\tlet d = JSON.parse(reData)\r\n\t\t\t\tif (d.type) return;\r\n\t\t\t\tlet data = d.data;\r\n\t\t\t\tif (data.source_id) {\r\n\t\t\t\t\tvar item = {\r\n\t\t\t\t\t\tgroup: 'group1',\r\n\t\t\t\t\t\tuindex: data.user_id,\r\n\t\t\t\t\t\tcontentType: 'txt',\r\n\t\t\t\t\t\tuname: data.user_id == this.user_id ? this.userName : this.lawyerName,\r\n\t\t\t\t\t\tcontent: data.message,\r\n\t\t\t\t\t\tuface: data.user_id == this.user_id ? this.$store.state.userInfo.avater : this.lawyerAvator || \"https://layer.boyaokj.cn/upload/20210813/1b54fb67409ad93d2eaf28ea20faa644.jpg\"\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.msgs.push(item);\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log('收到服务器消息', reData);\r\n\t\t\t\t// this.reset(); // 检测心跳reset,防止长时间连接导致连接关闭\r\n\t\t\t},\r\n\t\t\t// 检测心跳reset\r\n\t\t\treset() {\r\n\t\t\t\tclearInterval(this.timeoutObj);\r\n\t\t\t\tthis.start(); // 启动心跳\r\n\t\t\t},\r\n\t\t\t// 启动心跳 start\r\n\t\t\tstart() {\r\n\t\t\t\tthis.timeoutObj = setInterval(function() {\r\n\t\t\t\t\tuni.sendSocketMessage({\r\n\t\t\t\t\t\tdata: 'ping',\r\n\t\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\t\tconsole.log('连接中....');\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail: err => {\r\n\t\t\t\t\t\t\tconsole.log('连接失败重新连接....');\r\n\t\t\t\t\t\t\tthis.openConnection();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}, this.timeout);\r\n\t\t\t},\r\n\r\n\r\n\t\t\tasync sendText(msg) {\r\n\t\t\t\tconsole.log(msg);\r\n\t\t\t\tconsole.log(this.$store.state.userInfo.user_id);\r\n\t\t\t\tconsole.log(this.source_id);\r\n\t\t\t\tthis.checkOpenSocket();\r\n\t\t\t\tuni.sendSocketMessage({\r\n\t\t\t\t\tdata: JSON.stringify({\r\n\t\t\t\t\t\t\"action\": \"sendMessage\",\r\n\t\t\t\t\t\t\"data\": {\r\n\t\t\t\t\t\t\t\"source_id\": this.source_id,\r\n\t\t\t\t\t\t\t\"user_id\": this.$store.state.userInfo.user_id,\r\n\t\t\t\t\t\t\t\"message\": msg\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}),\r\n\t\t\t\t\tsuccess() {\r\n\t\t\t\t\t\tconsole.log('发消息成功');\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (res) => {\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle: '聊天连接失败',\r\n\t\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tthis.openConnection()\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 滚动条滚动 [ 有新消息可以自动滚动到底部 ]\r\n\t\t\tpageScroll: function() {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tuni.pageScrollTo({\r\n\t\t\t\t\t\tscrollTop: 999999 + Math.random(),\r\n\t\t\t\t\t\tduration: 100\r\n\t\t\t\t\t});\r\n\t\t\t\t}, 200);\r\n\t\t\t},\r\n\t\t\tasync getMessage() {\r\n\t\t\t\tlet res = await this.$myRequest({\r\n\t\t\t\t\turl: 'message/list',\r\n\t\t\t\t\tmethods: 'GET',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tsource_id: this.source_id\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (res && res.code == 200) {\r\n\t\t\t\t\tconsole.log('=====================getmessage==============');\r\n\t\t\t\t\tconsole.log(res);\r\n\t\t\t\t\tres.data.forEach(item => {\r\n\t\t\t\t\t\tif (item.user_id == this.user_id && (!this.userAvator || !this.userName)) {\r\n\t\t\t\t\t\t\tthis.userName = item.user.name;\r\n\t\t\t\t\t\t\tthis.userAvator = item.user.avater;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (item.user_id != this.user_id && (!this.lawyerAvator || !this.lawyerName)) {\r\n\t\t\t\t\t\t\tthis.lawyerName = item.user.name;\r\n\t\t\t\t\t\t\tthis.lawyerAvator = item.user.avater;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet d = {\r\n\t\t\t\t\t\t\tgroup: 'group1',\r\n\t\t\t\t\t\t\tuindex: item.user_id,\r\n\t\t\t\t\t\t\tuname: item.user_id == this.user_id ? item.user.name : item.user.name,\r\n\t\t\t\t\t\t\tcontentType: 'txt',\r\n\t\t\t\t\t\t\tcontent: item.message || '',\r\n\t\t\t\t\t\t\tuface: item.user_id == this.user_id ? item.user.avater : item.user.avater\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis.msgs.push(d);\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\r\n"],"sourceRoot":""}